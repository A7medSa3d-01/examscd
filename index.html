<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <title>Exams Count Down</title>
  </head>
  <body>
    <header>ما قبل العاصفة</header>
    <main>
      <h1>باقي علي امتحان اللغة العربية:</h1>
      <div id="countdown"></div>
    </main>
    <div class="tasks-title">
      <h2>المهام</h2>
      <p>يمكنك الضغط على زر ✔️ لتحديد المهمة كمنجزة.</p>
      <a href="manage-tasks.html">اضف مهمة جديدة</a>
    </div>
    <div id="todo-sections-grid">
      <section id="todo-section-1" class="todo-section">
        <h2>اللغة العربية</h2>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-1">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-1">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-1">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-1">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-1">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-1">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
      <section id="todo-section-2" class="todo-section">
        <h2>الانجليزي</h2>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-2">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-2">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-2">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-2">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-2">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-2">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
      <section id="todo-section-3" class="todo-section">
        <h2>الفيزياء</h2>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-3">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-3">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-3">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-3">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-3">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-3">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
      <section id="todo-section-4" class="todo-section">
        <h2>الكيمياء</h2>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-4">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-4">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-4">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-4">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-4">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-4">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
      <section id="todo-section-5" class="todo-section">
        <h2>الاحياء</h2>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-5">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-5">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-5">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-5">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-5">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-5">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
      <section id="todo-section-6" class="todo-section">
        <h2>مواد غير مضافة للمجموع</h2>
        <div class="progress-bar"></div>
        <ul class="todo-list">
          <!-- <li class="todo-item" data-index="0-6">
            <span class="todo-title">مراجعة الدروس الأساسية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="1-6">
            <span class="todo-title">حل نماذج امتحانات سابقة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="2-6">
            <span class="todo-title">تلخيص القواعد المهمة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="3-6">
            <span class="todo-title">مراجعة النصوص المحفوظة</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="4-6">
            <span class="todo-title">حل التدريبات الكتابية</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li>
          <li class="todo-item" data-index="5-6">
            <span class="todo-title">الراحة والنوم الجيد</span>
            <button class="done-btn" title="تم الإنجاز">✔️</button>
          </li> -->
        </ul>
      </section>
    </div>
  </body>
  <script>
    // Set the date we're counting down to
    const countDownDate = new Date("2025-06-22T09:00:00").getTime();

    // Update the count down every 1 second
    const x = setInterval(function () {
      const now = new Date().getTime();
      const distance = countDownDate - now;

      // Time calculations for days, hours, minutes and seconds
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor(
        (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
      );
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      // Display the result in the element with id="countdown"
      document.getElementById("countdown").innerHTML = `
      <div class="countdown-container">
        <div class="countdown-item">
          <span class="countdown-number">${days}</span>
          <span class="countdown-label">يوم</span>
        </div>
        <div class="countdown-item">
          <span class="countdown-number">${hours}</span>
          <span class="countdown-label">ساعة</span>
        </div>
        <div class="countdown-item">
          <span class="countdown-number">${minutes}</span>
          <span class="countdown-label">دقيقة</span>
        </div>
        <div class="countdown-item">
          <span class="countdown-number">${seconds}</span>
          <span class="countdown-label">ثانية</span>
        </div>
      </div>
    `;

      // If the count down is over, write some text
      if (distance < 0) {
        clearInterval(x);
        document.getElementById("countdown").innerHTML = "الامتحان قد بدأ!";
      }
    }, 1000);

    // To-Do List Logic
    const todoSections = Array.from(document.querySelectorAll(".todo-section"));
    const TASKS_KEY = "exam_tasks_status";
    let tasksStatus = JSON.parse(localStorage.getItem(TASKS_KEY));
    if (
      !Array.isArray(tasksStatus) ||
      tasksStatus.length !== todoSections.length
    ) {
      // Re-initialize if corrupted or mismatched
      tasksStatus = Array.from({ length: todoSections.length }, () => []);
    }

    // --- Custom Tasks Integration ---
    const CUSTOM_TASKS_KEY = "exam_tasks_custom";
    let customTasks = JSON.parse(localStorage.getItem(CUSTOM_TASKS_KEY));
    if (
      !Array.isArray(customTasks) ||
      customTasks.length !== todoSections.length
    ) {
      customTasks = Array.from({ length: todoSections.length }, () => []);
    }
    // Build a flat list of all tasks (default + custom) for each section
    const allTasks = todoSections.map((section, sectionIdx) => {
      const defaultTasks = Array.from(
        section.querySelectorAll(".todo-item:not(.custom-task) .todo-title")
      ).map((e) => e.textContent.trim());
      return [...defaultTasks, ...(customTasks[sectionIdx] || [])];
    });
    // Ensure tasksStatus matches the number of tasks in each section
    allTasks.forEach((tasks, sectionIdx) => {
      if (!Array.isArray(tasksStatus[sectionIdx])) tasksStatus[sectionIdx] = [];
      // Add missing slots as false
      while (tasksStatus[sectionIdx].length < tasks.length) {
        tasksStatus[sectionIdx].push(false);
      }
      // Remove extra slots
      while (tasksStatus[sectionIdx].length > tasks.length) {
        tasksStatus[sectionIdx].pop();
      }
    });
    localStorage.setItem(TASKS_KEY, JSON.stringify(tasksStatus));

    todoSections.forEach((section, sectionIdx) => {
      const todoList = section.querySelector(".todo-list");
      // Remove all custom tasks (if any)
      todoList.querySelectorAll(".custom-task").forEach((e) => e.remove());
      // Add custom tasks
      (customTasks[sectionIdx] || []).forEach((task, i) => {
        const li = document.createElement("li");
        li.className = "todo-item custom-task";
        li.innerHTML = `<span class="todo-title">${task}</span><button class="done-btn" title="تم الإنجاز">✔️</button>`;
        todoList.appendChild(li);
        // Ensure tasksStatus array is large enough
        if (!tasksStatus[sectionIdx]) tasksStatus[sectionIdx] = [];
        if (
          typeof tasksStatus[sectionIdx][todoList.children.length - 1] !==
          "boolean"
        ) {
          tasksStatus[sectionIdx][todoList.children.length - 1] = false;
        }
      });
      // Save tasksStatus to localStorage after custom tasks are added, so the array length matches the UI
      localStorage.setItem(TASKS_KEY, JSON.stringify(tasksStatus));
    });

    function updateTaskStyles() {
      todoSections.forEach((section, sectionIdx) => {
        const sectionTasks = tasksStatus[sectionIdx];
        section.querySelectorAll(".todo-item").forEach((item, idx) => {
          if (sectionTasks[idx]) {
            item.classList.add("done");
            item.classList.remove("not-done");
          } else {
            item.classList.remove("done");
            item.classList.add("not-done");
          }
        });
        // Add or update progress bar
        let progressBar = section.querySelector(".progress-bar");
        if (!progressBar) {
          progressBar = document.createElement("div");
          progressBar.className = "progress-bar";
          section.insertBefore(
            progressBar,
            section.querySelector(".todo-list")
          );
        }
        const doneCount = sectionTasks.filter(Boolean).length;
        const percent = Math.round((doneCount / sectionTasks.length) * 100);
        progressBar.innerHTML = `<div class=\"progress-track\"><div class=\"progress-fill\" style=\"width:${percent}%\"></div></div><span class=\"progress-text\">${percent}%</span>`;
      });
    }

    document
      .getElementById("todo-sections-grid")
      .addEventListener("click", function (e) {
        if (e.target.classList.contains("done-btn")) {
          const li = e.target.closest(".todo-item");
          const section = e.target.closest(".todo-section");
          const sectionIdx = Array.from(todoSections).indexOf(section);
          const idx = Array.from(
            section.querySelectorAll(".todo-item")
          ).indexOf(li);
          tasksStatus[sectionIdx][idx] = !tasksStatus[sectionIdx][idx];
          localStorage.setItem(TASKS_KEY, JSON.stringify(tasksStatus));
          updateTaskStyles();
        }
      });

    // On load, apply styles
    updateTaskStyles();
  </script>
</html>
